(function(a){var k=function(b,f,g){this.conf={style:"selectable",set:"show",out:"hide",setDuration:"normal",outDuration:"normal",opacity:1,top:0,left:0,callback:null};this.temp={selectable:'<div class="sctble_cont"/>',simpleBox:'<div class="simple_cont"/>'};a.extend(this.conf,f||{});a.extend(this.temp,g||{});this.target=a(b);this.attrs={id:this.target.attr("id"),cl:this.target.attr("class")};this.generatedFlg=false;this.init()};k.prototype={init:function(){this.build();this.bind_events();this.generatedFlg= true},rebuild:function(){this.m_input.unbind();this.mat.unbind();a("a",this.mat).unbind();a('label[for="'+this.attrs.id+'"]').unbind();this.build();this.bind_events()},build:function(){var b=a("optgroup",this.target).length>0?true:false,f=this,g=function(h,n){var i=a("<a/>");a(n).append(i);i.text(h.text()).attr({href:"#"+encodeURI(h.text()),name:h.val()});if(h.is(":selected")){f.m_text.text(h.text());i.addClass("selected")}h.hasClass("br")&&i.after("<br/>")};if(!this.m_input){this.m_input=a("<a/>"); this.m_text=a("<span/>");var d=this.conf.style.match(/simple/)?"sBox":"sctble";this.m_input.append(this.m_text).attr({id:this.attrs.id+"_dammy",href:"#"}).addClass("sctble_display").addClass(d).addClass(this.attrs.cl).insertAfter(this.target);this.target.hide();this.mat=a("<div/>");d=="simple"?this.mat.append(this.temp.selectable):this.mat.append(this.temp.simpleBox);this.mat.attr({id:this.attrs.id+"_mat"}).addClass(d).addClass(this.attrs.cl)}if(this.generatedFlg){this.mat.empty();d=="simple"?this.mat.append(this.temp.selectable): this.mat.append(this.temp.simpleBox)}this._div=a('<div class="body"/>');if(b){this.mat.addClass("otpgroup");b=a("optgroup",this.target);d=[];for(var e=0;e<b.length;e++)d[e]=a("option",b[e]);var c=a("<dl/>");for(e=0;e<b.length;e++){var j=a("<dt/>");j.text(a(b[e]).attr("label"));for(var m=a("<dd/>"),l=0;l<d[e].length;l++)g(a(d[e][l]),m);c.append(j).append(m)}this._div.append(c).addClass("optg");a("div",this.mat).append(this._div)}else{this.mat.addClass("nooptgroup");d=a("option",this.target);for(e= 0;e<d.length;e++)g(a(d[e]),this._div);a("div",this.mat).append(this._div.addClass("nooptg"))}if(!this.generatedFlg){a("body").append(this.mat);this.mat.addClass("sctble_mat").css({position:"absolute",zIndex:1E3,display:"none"});a("*:first-child",this.mat).addClass("first-child");a("*:last-child",this.mat).addClass("last-child")}if(document.all&&typeof document.body.style.maxHeight=="undefined")this.conf.height<this.mat.height()&&a(this._div).css("height",this.conf.height);else a(this._div).css("maxHeight", this.conf.height)},bind_events:function(){var b=this,f=true,g=function(){var c=b.m_input.offset();b.mat.css({top:c.top+b.m_input.height()*1.3+b.conf.top,left:c.left+b.conf.left})},d=function(){var c=a(".sctble_mat");switch(b.conf.out){case "slideUp":c.slideUp(b.conf.outDuration);break;case "fadeOut":c.fadeOut(b.conf.outDuration);break;default:c.hide();break}},e=function(){d();switch(b.conf.set){case "slideDown":b.mat.slideDown(b.conf.setDuration).css("opacity",b.conf.opacity);break;case "fadeIn":b.mat.css({display:"block", opacity:0}).fadeTo(b.conf.setDuration,b.conf.opacity);break;default:b.mat.show().css("opacity",b.conf.opacity);break}var c=isNaN(b.conf.setDuration)?null:b.conf.setDuration+10;if(c==null)interval=b.conf.setDuration.match(/slow/)?610:b.conf.setDuration.match(/normal/)?410:210;var j=setInterval(function(){a("a.selected",b.mat).focus();clearInterval(j)},c)};this.m_input.click(function(c){g();a(this).addClass("sctble_focus");a("a.sctble_display").not(this).removeClass("sctble_focus");e();c.stopPropagation(); return false}).keyup(function(c){if(f){g();e();c.stopPropagation()}else f=true});this.mat.click(function(c){c.stopPropagation()});a("body,a").not("a.sctble_display").click(function(){a("a.sctble_display").removeClass("sctble_focus");d()}).not("a").keyup(function(c){if(c.keyCode=="27"){a("a.sctble_focus").removeClass("sctble_focus");f=false;b.m_input.blur();d()}});a("a",this.mat).click(function(){var c=a(this);b.m_text.text(decodeURI(c.attr("href").split("#")[1]));a('option[value="'+c.attr("name")+ '"]',b.target).attr("selected","selected");a(".selected",b.mat).removeClass("selected");c.addClass("selected");b.m_input.removeClass("sctble_focus");f=false;d();b.conf.callback&&typeof b.conf.callback=="function"&&b.conf.callback.call(b.target);b.m_input.focus();return false});a('label[for="'+this.attrs.id+'"]').click(function(c){g();b.m_input.addClass("sctble_focus");a("a.sctble_focus").not(b.m_input).removeClass("sctble_focus");e();c.stopPropagation();return false})}};a.fn.jQselectable=function(b, f){if(a(this).length>1){var g=[];a(this).each(function(d){g[d]=new k(this,b,f)});return g}else return new k(this,b,f)};if(!jQuery.fn.selectable)a.fn.selectable=a.fn.jQselectable})(jQuery);